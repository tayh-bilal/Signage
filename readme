# üì∫ Digital Signage Player

A high-performance, auto-updating Electron application designed to synchronize video content across muti screens. This player uses a global clock synchronization method and a Supabase backend to ensure all screens play the same content at the exact same millisecond.

## üöÄ Key Features
* **Global Sync:** Uses time-offset logic to ensure frame-accurate synchronization across multiple devices.
* **Dynamic Polling:** * **Idle Mode:** Checks for new content every 10 seconds when no video is assigned.
    * **Playback Mode:** Checks for updates every 60 minutes to save bandwidth.
* **Background Auto-Updates:** Downloads new app versions silently and restarts automatically via GitHub Releases.
* **Hardware-Based Identity:** Automatically generates a unique "Clean ID" from the device's MAC address (e.g., `08EDB99EB573`).

---

## üõ† Project Structure
* `main.js`: Controls the Electron process, power management (prevents sleep), and the update engine.
* `player.html`: The core logic for video rendering, time-syncing, and polling Supabase.
* `package.json`: Manages dependencies and version control.
* `.gitignore`: Prevents heavy folders (`node_modules`, `dist`) from bloating the code repository.

---

## üîÑ How to Update the Code (Workflow)

When you need to change the player's behavior or fix a bug, follow these exact steps to update all the screens remotely.

### 1. Edit the Code
Make your changes locally in `player.html` or `main.js`. Test the changes by running:
```powershell
npm start



2. Increment the Version
The screens will only update if they detect a higher version number.

Open package.json.

Change "version": "1.0.4" to "version": "1.0.5" (or higher).

3. Build the Installer
Run the distribution script to package the app for Windows.

PowerShell:
rm -rf node_modules dist
npm install
npm run dist

Upload code to GitHub

Upload the installer to GitHub by making a new release.

This will generate a dist/ folder containing:

signage-player Setup 1.0.5.exe (The installer)

latest.yml (The "instruction" file for the auto-updater)


            
4. Launch the New Version (GitHub Release)
The screens monitor the Releases section of this repository.
Go to your GitHub Repo -> Releases -> Draft a new release.
Tag version: v1.0.5 (must match package.json).
Upload Assets: Drag and drop BOTH the .exe and the latest.yml from your dist/ folder.
Publish Release.

üì° The Update Lifecycle
Once you click Publish, the following happens automatically:
Detection: Within 60 minutes, the player checks GitHub and sees a new version is available.
Silent Download: The player downloads the new installer in the background while the current video continues to play.
Self-Installation: Once the download is 100% complete, the app calls quitAndInstall().
Auto-Restart: The app closes, installs the update, and relaunches within 10 seconds.
Recovery: The player reads the existing screen-config.json, identifies itself, and resumes the playlist.

üîß New Screen Setup
Download the latest .exe from the Releases tab.
Install on a Windows PC.
On first launch, a Green ID (MAC Address) will appear on the clock screen.
Add this ID to your Supabase screens table to begin pushing content.

‚å®Ô∏è Local Controls
F11: Toggle Fullscreen.
Arrow Right / Left: Adjust time offset (+/- 0.05s) to fine-tune synchronization.
Ctrl+R: Force Reload.

üîßHow to install on a new device?

run on powershell

# ===============================================
# FULL AUTOMATIC INSTALLER - LATEST RELEASE
# You control the install path
# ===============================================

# --- 1. SETTINGS ---
$repo = "tayh-bilal/Signage"

# <-- CHANGE THIS to your desired install folder -->
$installFolder = "C:\SignagePlayer"

# Path where the installer will be downloaded temporarily
$installerPath = "$env:TEMP\SignagePlayerInstaller.exe"

# Startup shortcut path
$shortcutPath = "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\SignagePlayer.lnk"

# --- 2. GET LATEST RELEASE INFO FROM GITHUB ---
Write-Host "--- Step 1: Fetching Latest Release ---" -ForegroundColor Cyan
$latestRelease = Invoke-RestMethod -Uri "https://api.github.com/repos/$repo/releases/latest"

# Extract version
$version = $latestRelease.tag_name.TrimStart("v")  

# Find the installer asset
$asset = $latestRelease.assets | Where-Object { $_.name -match "SignagePlayer.Setup.*$version.*\.exe" }

if (-not $asset) {
    Write-Host "‚ùå Installer for version $version not found in assets!" -ForegroundColor Red
    exit 1
}

$downloadUrl = $asset.browser_download_url
Write-Host "Latest version found: $version" -ForegroundColor Green
Write-Host "Download URL: $downloadUrl" -ForegroundColor Green

# --- 3. DOWNLOAD THE INSTALLER ---
Write-Host "--- Step 2: Downloading Installer ---" -ForegroundColor Cyan
Invoke-WebRequest -Uri $downloadUrl -OutFile $installerPath

# --- 4. CREATE INSTALL FOLDER IF NOT EXIST ---
if (-not (Test-Path $installFolder)) {
    New-Item -ItemType Directory -Path $installFolder | Out-Null
}

# --- 5. RUN INSTALLER SILENTLY ---
Write-Host "--- Step 3: Installing Player ---" -ForegroundColor Green

# Check if the installer supports custom folder and silent install
# NSIS common silent flags: /S /D=Path
Start-Process -FilePath $installerPath -ArgumentList "/S /D=$installFolder" -Wait

# --- 6. FIND THE EXE (in case installer puts it in subfolder like app-1.0.8) ---
$exePath = Get-ChildItem -Path $installFolder -Recurse -Filter "SignagePlayer.exe" -ErrorAction SilentlyContinue | Select-Object -First 1 | ForEach-Object { $_.FullName }

if (-not $exePath) {
    Write-Host "‚ùå Could not find SignagePlayer.exe in $installFolder" -ForegroundColor Red
    exit 1
}

# --- 7. CREATE STARTUP SHORTCUT ---
Write-Host "--- Step 4: Creating Startup Shortcut ---" -ForegroundColor Yellow
$shell = New-Object -ComObject WScript.Shell
$shortcut = $shell.CreateShortcut($shortcutPath)
$shortcut.TargetPath = $exePath
$shortcut.Save()
Write-Host "‚úÖ Startup shortcut created at $exePath" -ForegroundColor Green

# --- 8. CLEANUP ---
Remove-Item $installerPath
Write-Host "--- SUCCESS! ---" -ForegroundColor White -BackgroundColor DarkGreen
Write-Host "SignagePlayer is installed at $exePath and will launch at startup." -ForegroundColor White


# --- 9. kiosk mode ---
# 1. Define the app path
$appPath = "$env:LOCALAPPDATA\Programs\signage-player\signage-player.exe"

# 2. Check if the folder exists, if not, create it
$registryPath = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\System"
if (!(Test-Path $registryPath)) {
    New-Item -Path $registryPath -Force | Out-Null
    Write-Host "Created Registry folder: System" -ForegroundColor Cyan
}

# 3. Set the app as the Shell
Set-ItemProperty -Path $registryPath -Name "Shell" -Value $appPath
Write-Host "Success! Your app is now the Windows Shell." -ForegroundColor Green
Write-Host "Restart the computer to see Kiosk Mode in action." -ForegroundColor Yellow
